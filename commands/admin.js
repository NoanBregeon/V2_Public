const { SlashCommandBuilder, PermissionFlagsBits } = require('discord.js');
module.exports = { data:new SlashCommandBuilder().setName('admin').setDescription('Commandes administrateur').setDefaultMemberPermissions(PermissionFlagsBits.Administrator).setDMPermission(false).addSubcommand(sub=>sub.setName('reload').setDescription('Recharge les commandes et (optionnel) ré-enregistre').addBooleanOption(o=>o.setName('register').setDescription('Ré-enregistrer (défaut: true)').setRequired(false)).addBooleanOption(o=>o.setName('clean').setDescription('Nettoyer avant (danger)').setRequired(false))), async execute(interaction){ const sub=interaction.options.getSubcommand(); if(sub!=='reload') return interaction.reply({ content:'Sous-commande inconnue.', flags:64 }); if(process.env.OWNER_ID && interaction.user.id!==process.env.OWNER_ID) return interaction.reply({ content:'⛔ Commande réservée au propriétaire.', flags:64 }); await interaction.deferReply({ flags:64 }); const handler=interaction.client.moduleManager.get('commandHandler'); if(!handler) return interaction.editReply('❌ CommandHandler introuvable.'); await handler.loadCommands(); const doClean=interaction.options.getBoolean('clean')||false; const doRegisterOpt=interaction.options.getBoolean('register'); const shouldRegister=(doRegisterOpt===null||doRegisterOpt===undefined)?true:doRegisterOpt; if(doClean) await handler.cleanAllCommands(); if(shouldRegister) await handler.registerSlashCommands(); return interaction.editReply(`✅ Reload OK — ${handler.commands.size} commandes ${shouldRegister?'enregistrées':'chargées seulement'}${doClean?' (après nettoyage)':''}.`); } };
